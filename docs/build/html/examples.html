
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Examples &#8212; Web Traversal Framework  documentation</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="webtraversallibrary package" href="webtraversallibrary.html" />
    <link rel="prev" title="Changelog" href="CHANGELOG.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>Web Traversal Framework  documentation</span></a></h1>
        <h2 class="heading"><span>Examples</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="CHANGELOG.html">Changelog</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="webtraversallibrary.html">webtraversallibrary package</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="dataguy-by-element-py">
<h2>dataguy_by_element.py<a class="headerlink" href="#dataguy-by-element-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Clicks hard-coded menu items by element and selector.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]:</span>
    <span class="c1"># Picking an action at random relating to one of these elements</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span>
    <span class="n">menu_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">]</span>
    <span class="n">actions_a</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_element</span><span class="p">(</span><span class="n">menu_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Another way is doing it by selector - this one matches all the menu items (equivalent to the above)</span>
    <span class="n">actions_b</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="n">css</span><span class="o">=</span><span class="s2">&quot;.sidenav div a&quot;</span><span class="p">))</span>

    <span class="c1"># Click the first menu item and then, before snapshotting, the second</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">actions_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">actions_b</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="dementor-py">
<h2>dementor.py<a class="headerlink" href="#dementor-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Remove an element, one at a time, until the page is empty.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">workflow</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]]:</span>
    <span class="c1"># After seven deletions, start over from step 3</span>
    <span class="k">if</span> <span class="n">workflow</span><span class="o">.</span><span class="n">loop_idx</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Revert</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Randomly pick one of the deleting actions</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Remove</span><span class="p">)),</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Wait</span><span class="p">(</span><span class="mf">0.25</span><span class="p">),</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Clear</span><span class="p">(</span><span class="n">viewport</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">WaitForUser</span><span class="p">(),</span>
    <span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">wf</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dementor&quot;</span><span class="p">,</span>
            <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">highlight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Remove</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">e</span><span class="p">,</span>  <span class="c1"># Will label _all_ elements removable</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="dynamic-windows-py">
<h2>dynamic_windows.py<a class="headerlink" href="#dynamic-windows-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Dynamically handles multiple tabs and windows.</span>
<span class="sd">Creates new windows and/or tabs every iteration.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">workflow</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">,</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]:</span>
    <span class="n">loop_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">loop_idx</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">window_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">loop_idx</span> <span class="o">//</span> <span class="mi">3</span>

    <span class="c1"># Every third tab, create a new window, otherwise use the latest window</span>
    <span class="k">if</span> <span class="n">window_idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">windows</span><span class="p">):</span>
        <span class="n">window</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">create_window</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">window_idx</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">window</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">windows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Create a window to a new Wikipedia number link</span>
    <span class="n">window</span><span class="o">.</span><span class="n">create_tab</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">loop_idx</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://en.wikipedia.org/wiki/</span><span class="si">{</span><span class="n">loop_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Click a random clickable element in a random view/tab</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">choice</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))}</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">wf</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://en.wikipedia.org/wiki/0&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="fill-form-py">
<h2>fill_form.py<a class="headerlink" href="#fill-form-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Randomly fill all random text input fields on a page with a preset list of names.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Clear</span><span class="p">,</span> <span class="n">FillText</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">goal</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="c1"># Find all elements we could fill in text on</span>
    <span class="n">targets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">target</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">FillText</span><span class="p">)]</span>
    <span class="c1"># Get all their collective contents</span>
    <span class="n">texts</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">]</span>
    <span class="c1"># Stop running if they have all been filled</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">t</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">)</span>


<span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Robin Carpenter&quot;</span><span class="p">,</span> <span class="s2">&quot;Kenny Turner&quot;</span><span class="p">,</span> <span class="s2">&quot;Ernestine Ferguson&quot;</span><span class="p">,</span> <span class="s2">&quot;Marcelo Allen&quot;</span><span class="p">,</span> <span class="s2">&quot;Marilyn Rich&quot;</span><span class="p">,</span> <span class="s2">&quot;Rupert Strong&quot;</span><span class="p">]</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]:</span>
    <span class="c1"># Filter out all the FillText actions where the element is still empty</span>
    <span class="n">fill_actions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">action</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">FillText</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="c1"># Randomly pick an action and a text</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">fill_actions</span><span class="p">)</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="c1"># Execute</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">Clear</span><span class="p">(),</span> <span class="n">action</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">text_field_classifier_func</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Elements</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">PageElement</span><span class="p">]:</span>
    <span class="c1"># For now, we consider all input fields where the type attribute has a specific value.</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">)]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
        <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span>
        <span class="n">goal</span><span class="o">=</span><span class="n">goal</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://www.getharvest.com/signup&quot;</span><span class="p">,</span>
        <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># We just need a text field classifier, no need to consider what&#39;s active (all of them should be).</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;textfield&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">FillText</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">text_field_classifier_func</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workflow successful?&quot;</span><span class="p">,</span> <span class="n">workflow</span><span class="o">.</span><span class="n">success</span><span class="p">)</span>

    <span class="c1"># This is the last view, i.e. the one where goal() returned True</span>
    <span class="n">final_view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Get all texts</span>
    <span class="n">final_texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">final_view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">FillText</span><span class="p">)]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Names entered: &quot;</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">final_texts</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="gui-py">
<h2>gui.py<a class="headerlink" href="#gui-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Basic example of using WTL together with a graphical frontend.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># pylint: disable=global-statement</span>

<span class="kn">import</span> <span class="nn">tkinter</span> <span class="k">as</span> <span class="nn">tk</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Lock</span><span class="p">,</span> <span class="n">Thread</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">font</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>

<span class="c1"># === THREAD SYNC ===</span>
<span class="c1"># Global variables used for communicating.</span>
<span class="c1"># Uses a single lock for everything.</span>
<span class="c1"># 0=Waiting for new view, 1=Update GUI image, 2=Waiting for new action</span>

<span class="n">data_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
<span class="n">current_view</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">current_action</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>


<span class="c1"># === WTL THREAD ===</span>
<span class="c1"># Running WTL in a separate thread (so GUI can run on the main thread).</span>
<span class="c1"># Very simple state machine that saves the current view and busy waits</span>
<span class="c1"># until an action has been set from the GUI.</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">state</span><span class="p">,</span> <span class="n">current_view</span>

    <span class="k">with</span> <span class="n">data_lock</span><span class="p">:</span>
        <span class="n">current_view</span> <span class="o">=</span> <span class="n">view</span>
        <span class="n">state</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">data_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">current_action</span>

        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">wtl_thread</span><span class="p">(</span><span class="n">cli_args</span><span class="p">):</span>
    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>


<span class="c1"># === GUI THREAD (MAIN) ===</span>
<span class="c1">#</span>

<span class="n">show_actives</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">current_filename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>


<span class="k">def</span> <span class="nf">gui_thread</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up the window with design and all callbacks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">show_actives</span>

    <span class="n">window</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
    <span class="n">window</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;WTL browser&quot;</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;1920x1080&quot;</span><span class="p">)</span>

    <span class="n">top_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">()</span>

    <span class="n">canvas</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="n">top_frame</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1280</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1080</span><span class="p">)</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">show_actives</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>
    <span class="n">ch</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Checkbutton</span><span class="p">(</span><span class="n">top_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Show active elements&quot;</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="n">show_actives</span><span class="p">)</span>
    <span class="n">ch</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">)</span>

    <span class="n">small_font</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">listbox</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Listbox</span><span class="p">(</span><span class="n">top_frame</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">375</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">small_font</span><span class="p">)</span>
    <span class="n">listbox</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">)</span>

    <span class="n">label_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="n">label_frame</span><span class="o">.</span><span class="n">pack_propagate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">desc_label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">label_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">wraplength</span><span class="o">=</span><span class="mi">1300</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="n">desc_label</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
    <span class="n">label_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
    <span class="n">top_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_element</span><span class="p">(</span><span class="n">mouse</span><span class="p">):</span>  <span class="c1"># pylint: disable=inconsistent-return-statements</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Look for the element at current coords with smallest bounds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">point</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">mouse</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">mouse</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">data_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">current_view</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="n">smallest_element</span><span class="p">,</span> <span class="n">smallest_area</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">999999</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">current_view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">bounds</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">area</span> <span class="o">&lt;</span> <span class="n">smallest_area</span><span class="p">:</span>
                    <span class="n">smallest_area</span><span class="p">,</span> <span class="n">smallest_element</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="n">e</span>

        <span class="k">return</span> <span class="n">smallest_element</span>

    <span class="k">def</span> <span class="nf">hover</span><span class="p">(</span><span class="n">mouse</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the top label when hovering over an element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">nonlocal</span> <span class="n">desc_label</span>

        <span class="n">smallest_element</span> <span class="o">=</span> <span class="n">get_element</span><span class="p">(</span><span class="n">mouse</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">data_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">smallest_element</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">smallest_element</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;text&quot;</span><span class="p">]</span>
                <span class="n">desc_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">desc_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">double_clicked</span><span class="p">(</span><span class="n">mouse</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set action of the clicked element.</span>
<span class="sd">        Does not check if it&#39;s active or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">state</span><span class="p">,</span> <span class="n">current_action</span>

        <span class="n">smallest_element</span> <span class="o">=</span> <span class="n">get_element</span><span class="p">(</span><span class="n">mouse</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">data_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">smallest_element</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">current_action</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[wtl-uid=&quot;</span><span class="si">{</span><span class="n">smallest_element</span><span class="o">.</span><span class="n">wtl_uid</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">selected</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets action by clicking an element in the listbox.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">state</span><span class="p">,</span> <span class="n">current_action</span>
        <span class="k">nonlocal</span> <span class="n">listbox</span>

        <span class="k">with</span> <span class="n">data_lock</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">listbox</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">listbox</span><span class="o">.</span><span class="n">curselection</span><span class="p">()))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; (&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">current_action</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[wtl-uid=&quot;</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">))</span>

    <span class="c1"># Bind functions to the GUI objects</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Motion&gt;&quot;</span><span class="p">,</span> <span class="n">hover</span><span class="p">)</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Double-Button-1&gt;&quot;</span><span class="p">,</span> <span class="n">double_clicked</span><span class="p">)</span>
    <span class="n">listbox</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;ListboxSelect&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">selected</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">upd_view</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks state and updates the GUI with screenshot and list of actions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">state</span><span class="p">,</span> <span class="n">current_view</span><span class="p">,</span> <span class="n">show_actives</span><span class="p">,</span> <span class="n">current_filename</span>
        <span class="k">nonlocal</span> <span class="n">img</span><span class="p">,</span> <span class="n">listbox</span>

        <span class="k">with</span> <span class="n">data_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">current_filename</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">listbox</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">current_view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">):</span>
                    <span class="n">wtl_uid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">wtl_uid</span><span class="p">)</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
                    <span class="n">listbox</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">,</span> <span class="n">wtl_uid</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;first&quot;</span> <span class="k">if</span> <span class="n">show_actives</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;is_active&quot;</span>
                <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="n">current_filename</span><span class="p">:</span>
                    <span class="n">current_filename</span> <span class="o">=</span> <span class="n">filename</span>
                    <span class="n">current_view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">screenshots</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
                    <span class="n">canvas</span><span class="o">.</span><span class="n">create_image</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">NW</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">img</span><span class="p">)</span>

        <span class="n">window</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="n">upd_view</span><span class="p">)</span>

    <span class="n">window</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">upd_view</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>


<span class="c1"># === === === === ===</span>
<span class="c1"># Entry point: Setup WTL thread and run GUI on this (main) thread.</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">_cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>
    <span class="n">_wtl_thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">wtl_thread</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">_cli_args</span><span class="p">,))</span>
    <span class="n">_wtl_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">gui_thread</span><span class="p">()</span>
    <span class="n">_wtl_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="hard-coded-py">
<h2>hard_coded.py<a class="headerlink" href="#hard-coded-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Simple example showing a hard-coded generator of actions.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Clear</span><span class="p">,</span> <span class="n">Click</span><span class="p">,</span> <span class="n">Highlight</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span><span class="p">,</span> <span class="n">start_server</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab_coroutine</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">():</span>
    <span class="c1"># Highlight some titles, and then click a menu item.</span>
    <span class="c1"># Once the generator is exhausted, workflow will interpret StopIteration as cancelling the tabs.</span>

    <span class="k">yield</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
        <span class="k">yield</span> <span class="p">[</span><span class="n">Clear</span><span class="p">(),</span> <span class="n">Highlight</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;h2:nth-of-type(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">) &gt; a&quot;</span><span class="p">))]</span>
    <span class="k">yield</span> <span class="n">Click</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;h2:nth-of-type(1) &gt; a&quot;</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">start_server</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/blog&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="href-scorer-py">
<h2>href_scorer.py<a class="headerlink" href="#href-scorer-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Ranks all links on a page by the length of the HREF attribute.</span>
<span class="sd">Does nothing with them.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Wait</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">):</span>
    <span class="c1"># Wait so that the classifier isn&#39;t run over and over again</span>
    <span class="k">return</span> <span class="n">Wait</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">url_length_classifier_func</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="c1"># Score all elements with an href attribute with a score of the length of the href attribute</span>
    <span class="n">href_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]]</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">element</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]))</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">href_elements</span><span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;url_length&quot;</span><span class="p">,</span>
            <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">ScalingMode</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">,</span>
            <span class="n">highlight_color</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">url_length_classifier_func</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="interactive-py">
<h2>interactive.py<a class="headerlink" href="#interactive-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Simple example of an interactive &quot;game&quot;, as an old-style text RPG, for web traversal.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>

<span class="n">initials</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;You see a house. Above the door hangs a sign: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;You are in an open field. You find a note that says: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;You are inside an old cottage. On the wall you see something written: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;You are standing in the wtl office. It is loud. One of the screens say: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;Rain is pouring through the broken roof. The rain patters a sound. You make out: &quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="n">textfield_desc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;A wild Croatian appears and asks you for a name. He hands you a paper and pen to write with.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;An empty notepad really wants something to be written.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;You see a dusty whiteboard with a pen that still works.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;A piece of paper is asking you what is on your mind. You have a pen in your hand.&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="n">vague_desc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;You can see people in the distance.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wtluts are ringing a bell.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Everything around you looks really clean.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;There are multiple paths forward.&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="n">content_desc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;A bleached old parchment says: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;A pretty little note by your feet says: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;You find an old metal bracelet with an inscription: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;You are standing next to an old radio. When you try turning it on, it repeats over and over again: &quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab_coroutine</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> === === === </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span>
    <span class="n">initial</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">initials</span><span class="p">)</span>
    <span class="n">spoken</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spoken</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">page_metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">initial</span><span class="si">}</span><span class="s1">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="n">spoken</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&gt; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;help&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Available commands:</span><span class="se">\n</span><span class="s2">help: shows this message&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;navigate&quot;</span> <span class="ow">or</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;jump&quot;</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Navigate</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;look&quot;</span><span class="p">:</span>
            <span class="n">buttons</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">)</span>
            <span class="n">textfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">FillText</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
            <span class="n">texts</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;h1&quot;</span><span class="p">))</span>
                <span class="o">+</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;h2&quot;</span><span class="p">))</span>
                <span class="o">+</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;h3&quot;</span><span class="p">))</span>
                <span class="o">+</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">))</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">textfields</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">textfield_desc</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">buttons</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">vague_desc</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">texts</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">content_desc</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;click&quot;</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[value~=&quot;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span> <span class="k">if</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;move&quot;</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))</span>
            <span class="n">initial</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">initials</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;write&quot;</span><span class="p">:</span>
            <span class="n">textfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">FillText</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">textfields</span><span class="p">)(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I do not understand.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">spoken</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">action</span>


<span class="k">def</span> <span class="nf">text_field_classifier_func</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Elements</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">PageElement</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">)]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;textfield&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">FillText</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">text_field_classifier_func</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;wtl&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="largest-image-py">
<h2>largest_image.py<a class="headerlink" href="#largest-image-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Ranks all images on a page by their geometric size.</span>
<span class="sd">Clicks on the largest, then checks if the URL changed, then stops.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Click</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.goals</span> <span class="kn">import</span> <span class="n">N_STEPS</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>

<span class="n">goal</span> <span class="o">=</span> <span class="n">N_STEPS</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">workflow</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">images_by_size</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_score</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="n">element</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Click</span><span class="p">(</span><span class="n">images_by_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">page_metadata</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">page_metadata</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">image_classifier_func</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;img&quot;</span><span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">wf</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">goal</span><span class="o">=</span><span class="n">goal</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">image_classifier_func</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="monkeypatch-py">
<h2>monkeypatch.py<a class="headerlink" href="#monkeypatch-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Click any active element, but all links lead to Rome, literally, using workflow.monkeypatches.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Click</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">:</span>
    <span class="n">menu_actions</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">Click</span><span class="p">)</span><span class="o">.</span><span class="n">by_score</span><span class="p">(</span><span class="s2">&quot;is_active&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">choice</span><span class="p">(</span><span class="n">menu_actions</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">monkeypatches</span><span class="o">.</span><span class="n">set_default</span><span class="p">(</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Rome&quot;</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="multiples-py">
<h2>multiples.py<a class="headerlink" href="#multiples-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Creates a total of three tabs in two windows, and clicks randomly on all of them.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">,</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">choice</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
        <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;first&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="s2">&quot;www.uppsalahandkraft.se&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.uppsalamodemassa.se&quot;</span><span class="p">},</span>
            <span class="s2">&quot;second&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="s2">&quot;shop.biskopsgarden.com&quot;</span><span class="p">},</span>
        <span class="p">},</span>
        <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="random-dataguy-py">
<h2>random_dataguy.py<a class="headerlink" href="#random-dataguy-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defines a subset of all active elements (menu items) and clicks randomly on those.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Click</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">:</span>
    <span class="n">menu_actions</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">Click</span><span class="p">)</span><span class="o">.</span><span class="n">by_score</span><span class="p">(</span><span class="s2">&quot;menu&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">choice</span><span class="p">(</span><span class="n">menu_actions</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">menu_classifier_func</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Elements</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">PageElement</span><span class="p">]:</span>
    <span class="c1"># The condition here is completely hard-coded for the given page.</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;menu&quot;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">,</span>
            <span class="n">subset</span><span class="o">=</span><span class="s2">&quot;is_active&quot;</span><span class="p">,</span>  <span class="c1"># Consider only active elements</span>
            <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">menu_classifier_func</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="random-dataguy-memory-py">
<h2>random_dataguy_memory.py<a class="headerlink" href="#random-dataguy-memory-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defines a subset of all active elements (menu items) and clicks randomly on those exactly once.</span>
<span class="sd">When they have all been clicked, abort the workflow.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Abort</span><span class="p">,</span> <span class="n">Click</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">workflow</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">:</span>
    <span class="k">if</span> <span class="s2">&quot;previous&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
        <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;previous&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">js</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
            <span class="n">wtl</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;This is an annotation&quot;</span><span class="p">,</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">workflow</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">screenshots</span><span class="p">:</span>
            <span class="c1"># Create screenshot of previous actions with an emphasis on the latest</span>
            <span class="n">scr</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">new_screenshot</span><span class="p">(</span><span class="s2">&quot;history&quot;</span><span class="p">,</span> <span class="n">of</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">prev</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;previous&quot;</span><span class="p">]:</span>
                <span class="n">scr</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">prev</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
            <span class="n">scr</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span>
                <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;previous_action&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Latest action&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">scr</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">output_path</span><span class="p">)</span>

            <span class="c1"># Save screenshot of the current live view</span>
            <span class="n">workflow</span><span class="o">.</span><span class="n">scraper</span><span class="o">.</span><span class="n">capture_screenshot</span><span class="p">(</span><span class="s2">&quot;live&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">output_path</span><span class="p">)</span>

    <span class="c1"># Get all elements tagged as &quot;menu&quot;</span>
    <span class="n">menu_elements</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_score</span><span class="p">(</span><span class="s2">&quot;menu&quot;</span><span class="p">)</span>

    <span class="c1"># Filter out those we have already clicked on</span>
    <span class="n">menu_elements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">menu_elements</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;previous&quot;</span><span class="p">]]</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">menu_elements</span><span class="p">:</span>
        <span class="c1"># If there are any left, click that and remember its text</span>
        <span class="n">element</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">menu_elements</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">Click</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;previous&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Otherwise, stop everything</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">Abort</span><span class="p">()</span>

    <span class="c1"># Return</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Here are the buttons I&#39;ve clicked: &quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;previous&quot;</span><span class="p">]])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Last time I did&quot;</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;previous_action&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">action</span>


<span class="k">def</span> <span class="nf">menu_classifier_func</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Elements</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">PageElement</span><span class="p">]:</span>
    <span class="c1"># The condition here is completely hard-coded for the given page.</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">wf</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;menu&quot;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">,</span>
            <span class="n">subset</span><span class="o">=</span><span class="s2">&quot;is_active&quot;</span><span class="p">,</span>  <span class="c1"># Consider only active elements</span>
            <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">menu_classifier_func</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="random-traversal-py">
<h2>random_traversal.py<a class="headerlink" href="#random-traversal-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Click on any random clickable element on a page.</span>
<span class="sd">Also demonstrates the use of postload_callbacks.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span><span class="p">,</span> <span class="n">random</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Click</span><span class="p">,</span> <span class="n">Refresh</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">workflow</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">workflow</span><span class="o">.</span><span class="n">duplicate_loop_idx</span> <span class="o">==</span> <span class="n">workflow</span><span class="o">.</span><span class="n">loop_idx</span>

    <span class="c1"># With some small probabilty, refresh instead of clicking.</span>
    <span class="k">return</span> <span class="n">choice</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">Click</span><span class="p">))</span> <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.95</span> <span class="k">else</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">Refresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">set_duplicate_loop_idx</span><span class="p">(</span><span class="n">workflow</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">):</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">duplicate_loop_idx</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">loop_idx</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">wf</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">postload_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">set_duplicate_loop_idx</span><span class="p">,</span> <span class="n">wf</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="size-scorer-py">
<h2>size_scorer.py<a class="headerlink" href="#size-scorer-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Classifies active elements with a &quot;size score&quot; and then clicks some element with average size.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Click</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">choice</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">Click</span><span class="p">)</span><span class="o">.</span><span class="n">by_score</span><span class="p">(</span><span class="s2">&quot;size__average&quot;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">size_classifier_func</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Elements</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="c1"># Computes a normalized size.</span>
    <span class="c1"># Note that this is not the simplest way of clicking the largest clickable element.</span>

    <span class="n">largest_area</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">area</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">element</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="n">largest_area</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;big&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="n">e</span><span class="p">,</span> <span class="n">score</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">score</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.75</span><span class="p">],</span>
        <span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="n">e</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">score</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="mf">0.25</span> <span class="o">&lt;</span> <span class="n">score</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.75</span><span class="p">],</span>
    <span class="p">}</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">())</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="s2">&quot;is_active&quot;</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">size_classifier_func</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">workflow</span><span class="p">:</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="tictactoe-py">
<h2>tictactoe.py<a class="headerlink" href="#tictactoe-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Plays TicTacToe online by using a simple AI implementation.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Click</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="k">def</span> <span class="nf">checkWin</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">getAIMove</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">nextMove</span><span class="p">,</span> <span class="n">aiPlayer</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">checkWin</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">aiPlayer</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">checkWin</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span> <span class="k">if</span> <span class="n">aiPlayer</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span> <span class="k">else</span> <span class="s2">&quot;X&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">board</span><span class="p">)</span> <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">free</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">free</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">board</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">moves</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">free</span><span class="p">:</span>
        <span class="n">nextBoard</span> <span class="o">=</span> <span class="n">board</span><span class="p">[:]</span>
        <span class="n">nextBoard</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nextMove</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">getAIMove</span><span class="p">(</span><span class="n">nextBoard</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span> <span class="k">if</span> <span class="n">nextMove</span> <span class="o">==</span> <span class="s2">&quot;O&quot;</span> <span class="k">else</span> <span class="s2">&quot;O&quot;</span><span class="p">),</span> <span class="n">aiPlayer</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">moves</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">score</span><span class="p">))</span>

    <span class="n">moves</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="n">nextMove</span> <span class="o">==</span> <span class="n">aiPlayer</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">moves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">printBoard</span><span class="p">(</span><span class="n">board</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;   &quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;   &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]:</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_score</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="n">tiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">target</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_score</span><span class="p">(</span><span class="s2">&quot;tile&quot;</span><span class="p">)]</span>
    <span class="n">board</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot; &quot;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tiles</span><span class="p">]</span>
    <span class="n">move</span> <span class="o">=</span> <span class="n">getAIMove</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">)</span>

    <span class="n">printBoard</span><span class="p">(</span><span class="n">board</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Clear</span><span class="p">(</span><span class="n">viewport</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">(</span><span class="n">tiles</span><span class="p">[</span><span class="n">move</span><span class="p">[</span><span class="mi">0</span><span class="p">]])]</span>


<span class="k">def</span> <span class="nf">_start_btn</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;sync-task-cover&quot;</span> <span class="ow">and</span> <span class="s2">&quot;block&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;display&quot;</span><span class="p">]]</span>


<span class="k">def</span> <span class="nf">_tile_div</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">e</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;span&quot;</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ttt&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;div&quot;</span>
    <span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
        <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://stanfordnlp.github.io/miniwob-plusplus/html/miniwob/tic-tac-toe.html&quot;</span><span class="p">,</span>
        <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">())</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">_start_btn</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;tile&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">_tile_div</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="util-py">
<h2>util.py<a class="headerlink" href="#util-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Not an example, just helper functions for the other examples.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>


<span class="k">def</span> <span class="nf">start_server</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">my_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">my_env</span><span class="p">[</span><span class="s2">&quot;FLASK_APP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tests/site/flask_app.py&quot;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s2">&quot;python3 -m flask run&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">env</span><span class="o">=</span><span class="n">my_env</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;http://localhost:5000&quot;</span>


<span class="k">def</span> <span class="nf">parse_cli_args</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ArgumentParser</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses CLI flags relevant for examples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">()</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;Run parameters&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--url&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;DEFAULT&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;URL to run the workflow on.&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--output&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">Path</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Where to save the result locally. If save, remember to also add save flag for config.&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--windows&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="o">.</span><span class="n">SINGLE_TAB</span><span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Tab names (comma-separated). Use space separation for multiple windows.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Names of config files in config/, such as &quot;</span> <span class="s1">&#39;&quot;iphone_x_mobile&quot;, or key=value pairs.&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cli_args</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="s2">&quot;DEFAULT&quot;</span><span class="p">:</span>
        <span class="n">cli_args</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">start_server</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">cli_args</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="view-classifier-py">
<h2>view_classifier.py<a class="headerlink" href="#view-classifier-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Clicks randomly on a page until _dataguy_ is not part of the URL anymore, using a ViewClassifier.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Set</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Annotate</span><span class="p">,</span> <span class="n">Clear</span><span class="p">,</span> <span class="n">Click</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">goal</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
    <span class="c1"># Stop when we dataguy is not part of the URL</span>
    <span class="k">return</span> <span class="s2">&quot;dataguy&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">tags</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]:</span>
    <span class="c1"># Do any random click</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">Clear</span><span class="p">(),</span>
        <span class="n">Annotate</span><span class="p">(</span>
            <span class="n">location</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Still dataguy&quot;</span><span class="p">,</span>
            <span class="n">background</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">choice</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">Click</span><span class="p">)),</span>
    <span class="p">]</span>


<span class="k">def</span> <span class="nf">dataguy_classifier_func</span><span class="p">(</span><span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="c1"># This will assign &quot;dataguy&quot; to a view if the URL contains that, otherwise &quot;other&quot;</span>
    <span class="c1"># It can be retreived with view.tags</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;dataguy&quot;</span> <span class="k">if</span> <span class="s2">&quot;dataguy&quot;</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">page_metadata</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;other&quot;</span><span class="p">}</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>

    <span class="c1"># The syntax for a ViewClassifier is similar, but simpler</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ViewClassifier</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;dataguy&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">dataguy_classifier_func</span><span class="p">))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="wiki-game-py">
<h2>wiki_game.py<a class="headerlink" href="#wiki-game-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Click on any random clickable element on a page.</span>
<span class="sd">Also demonstrates the use of postload_callbacks.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Abort</span><span class="p">,</span> <span class="n">Click</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab_coroutine</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">():</span>
    <span class="n">workflow</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span>

    <span class="c1"># Store Page A&#39;s URL</span>
    <span class="n">page_a_url</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">current_window</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span>
    <span class="n">workflow</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">Click</span><span class="p">(</span>
        <span class="n">choice</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_subtree</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;div[id=&#39;bodyContent&#39;]&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)))</span>
    <span class="p">)</span>

    <span class="c1"># Store Page B&#39;s URL</span>
    <span class="n">page_b_url</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">current_window</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1"># Stores first paragraph from page B&#39;s body</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;div p:nth-of-type(1)&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">description</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;div p:nth-of-type(2)&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>

    <span class="c1"># Limit the description to 50 characters to improve search</span>
    <span class="n">description_subset</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">description</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">49</span><span class="p">])</span>

    <span class="c1"># Navigate back to page A</span>
    <span class="n">workflow</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Navigate</span><span class="p">(</span><span class="n">page_a_url</span><span class="p">)</span>

    <span class="n">link_to_click</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;input[type=&#39;submit&#39;]&quot;</span><span class="p">))</span>

    <span class="c1"># In the search bar in page A, fill text with description_subset and</span>
    <span class="c1"># click search to get search results for the descriptions</span>

    <span class="n">workflow</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span> <span class="p">[</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">FillText</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;input[type=&#39;search&#39;]&quot;</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">description_subset</span><span class="p">)),</span>
        <span class="n">Click</span><span class="p">(</span><span class="n">link_to_click</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="p">]</span>

    <span class="c1"># Store search result&#39;s URL</span>
    <span class="n">search_url</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">current_window</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span>

    <span class="n">search_results</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;div[class=mw-search-result-heading] a&quot;</span><span class="p">))</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Go to first link in the search result</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">workflow</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">Click</span><span class="p">(</span><span class="n">search_results</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Empty search results!!&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">Abort</span><span class="p">()</span>

    <span class="c1"># Check if landing URL equals PAGE B URL, if yes, break, else iterate and go to next link in the search result</span>
    <span class="c1"># untill the URL&#39;s match</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">workflow</span><span class="o">.</span><span class="n">current_window</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span> <span class="o">==</span> <span class="n">page_b_url</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Woohoo!!!&quot;</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">workflow</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span> <span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Navigate</span><span class="p">(</span><span class="n">search_url</span><span class="p">),</span> <span class="n">Click</span><span class="p">(</span><span class="n">search_results</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])]</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Search result exhausted!!&quot;</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="k">yield</span> <span class="kc">None</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">wf</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
        <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Special:Random&quot;</span><span class="p">,</span>
        <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;textfield&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">FillText</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="without-workflow-py">
<h2>without_workflow.py<a class="headerlink" href="#without-workflow-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Goes to a random wikipage, finds &#39;n&#39; most common words in the article, where &#39;n&#39; being the number of</span>
<span class="sd">most common words that the user wants.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>

<span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

<span class="n">window</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># Navigates to a Wiki article chosen at random</span>
<span class="n">window</span><span class="o">.</span><span class="n">scraper</span><span class="o">.</span><span class="n">navigate</span><span class="p">(</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Special:Random&quot;</span><span class="p">)</span>

<span class="c1"># Takes a snapshot of the current page</span>
<span class="n">snapshot</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">scraper</span><span class="o">.</span><span class="n">scrape_current_page</span><span class="p">()</span>

<span class="c1"># Fetches all the elements with links in the current page</span>
<span class="n">links</span> <span class="o">=</span> <span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">))</span>  <span class="c1"># pylint: disable=no-member</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of links in the article &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">))</span>

<span class="c1"># Gets the current URL of the page</span>
<span class="n">search_url</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Link to the wiki article : &quot;</span><span class="p">,</span> <span class="n">search_url</span><span class="p">)</span>

<span class="n">paragraphs</span> <span class="o">=</span> <span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;div p&quot;</span><span class="p">))</span>  <span class="c1"># pylint: disable=no-member</span>
<span class="n">article</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="c1"># Fetch stopwords from a local file containing an array of stopwords</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;examples/stopwords.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">stopwords</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paragraphs</span><span class="p">:</span>
    <span class="n">article</span> <span class="o">=</span> <span class="n">article</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>

<span class="c1"># Find n most common words in the article, where n being the number of common words required by the user</span>

<span class="n">wordcount</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">article</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">:</span>
        <span class="n">wordcount</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">n_print</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;How many most common words to print: &quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">OK. The </span><span class="si">{}</span><span class="s2"> most common words are as follows</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_print</span><span class="p">))</span>
<span class="n">word_counter</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">wordcount</span><span class="p">)</span>
<span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">word_counter</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">n_print</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="s2">&quot;: &quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>

<span class="c1"># Close the browser</span>
<span class="n">window</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="zindex-py">
<h2>zindex.py<a class="headerlink" href="#zindex-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Compute the zIndex of all active elements and highlights the top 1% elements.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.logging</span> <span class="kn">import</span> <span class="n">setup_logging</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">WaitForUser</span><span class="p">()</span>


<span class="c1"># https://stackoverflow.com/questions/1388007/getting-the-z-index-of-a-div-in-javascript</span>
<span class="n">Z_INDEX_JS</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">window.getZIndex = function (e) {</span>
<span class="s2">  if (e === null) {</span>
<span class="s2">    return 0;</span>
<span class="s2">  }</span>
<span class="s2">  let z = window.document.defaultView.getComputedStyle(e).getPropertyValue(&#39;z-index&#39;);</span>
<span class="s2">  if (isNaN(z)) {</span>
<span class="s2">    return window.getZIndex(e.parentElement);</span>
<span class="s2">  }</span>
<span class="s2">  return z;</span>
<span class="s2">};</span>
<span class="s2">console.log(&quot;Hello!&quot;);</span>
<span class="s2">let element = document.querySelector(arguments[0]);</span>
<span class="s2">if (element !== null) {</span>
<span class="s2">  return window.getZIndex(element);</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">_compute_z_index</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Elements</span><span class="p">,</span> <span class="n">workflow</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">PageElement</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
    <span class="c1"># This may be slow for many elements. If you need more performance, consider a JS script</span>
    <span class="c1"># which computes all elements&#39; z-values combined and returns the map directly.</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
        <span class="n">zIndex</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">js</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">Z_INDEX_JS</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">selector</span><span class="o">.</span><span class="n">css</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">e</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">zIndex</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">wf</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;zIndex&quot;</span><span class="p">,</span>
            <span class="n">subset</span><span class="o">=</span><span class="s2">&quot;is_active&quot;</span><span class="p">,</span>
            <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">highlight</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">ScalingMode</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">_compute_z_index</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">setup_logging</span><span class="p">(</span><span class="n">logging_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="CHANGELOG.html">Changelog</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="webtraversallibrary.html">webtraversallibrary package</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2019 Klarna Bank AB (publ).
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>